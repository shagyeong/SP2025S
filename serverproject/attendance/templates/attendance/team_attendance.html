{% extends 'instructor/base_instructor.html' %}
{% load static %}

{% block title %}ì¶œê²° ìƒì„¸{% endblock %}

{% block content %}
<div class="attendance-detail-page">
    <h1>ğŸ“‹ ì¶œê²° ìƒì„¸</h1>

    <div>
        <label for="team-select">íŒ€ ID: </label>
        <input type="text" id="team-id" placeholder="ì˜ˆ: 01-001SP2025S-1">
        <label for="round-select">íšŒì°¨: </label>
        <select id="round-select">
            {% for i in "01,02,03,04,05,06,07,08,09,10".split(",") %}
            <option value="{{ i }}">{{ i }}íšŒì°¨</option>
            {% endfor %}
        </select>
        <button id="load-team-attendance">ì¡°íšŒ</button>
    </div>

    <table class="attendance-table" style="margin-top: 20px;">
        <thead>
            <tr>
                <th>ì—­í• </th>
                <th>í•™ë²ˆ</th>
                <th>ì¶œê²°</th>
            </tr>
        </thead>
        <tbody id="attendance-body">
            <!-- JSë¡œ ë Œë”ë§ -->
        </tbody>
    </table>

    <button onclick="goBack()" style="margin-top: 20px;">â† ëŒì•„ê°€ê¸°</button>
</div>
{% endblock %}

{% block extra_js %}
<script>
function goBack() {
    window.history.back();
}

document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("load-team-attendance").addEventListener("click", () => {
        const teamId = document.getElementById("team-id").value.trim();
        const round = document.getElementById("round-select").value;

        if (!teamId || !round) {
            alert("íŒ€ IDì™€ íšŒì°¨ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
            return;
        }

        fetch(`/attendance/${teamId}/${round}/`)
            .then(res => res.json())
            .then(data => {
                const tableBody = document.getElementById("attendance-body");
                tableBody.innerHTML = "";

                const fields = {
                    at_leader: "íŒ€ì¥",
                    at_mate1: "íŒ€ì›1",
                    at_mate2: "íŒ€ì›2",
                    at_mate3: "íŒ€ì›3",
                    at_mate4: "íŒ€ì›4"
                };

                Object.entries(fields).forEach(([key, label]) => {
                    const status = data[key] === "o" ? "âœ… ì¶œì„" : "âŒ ê²°ì„";
                    const studentId = data.team?.[key.replace("at_", "") + "_id"] || "-";
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${label}</td>
                        <td>${studentId}</td>
                        <td>${status}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(err => {
                alert("ì¶œê²° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                console.error(err);
            });
    });
});
</script>
{% endblock %}
