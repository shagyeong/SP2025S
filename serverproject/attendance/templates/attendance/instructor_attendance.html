{% extends 'instructor/base_instructor.html' %}
{% load static %}

{% block title %}êµìˆ˜ì ì¶œê²° í™•ì¸{% endblock %}

{% block content %}
<div class="instructor-page">
    <h1>ğŸ‘¨â€ğŸ« ì¶œê²° ê´€ë¦¬</h1>

    <section class="team-list-section">
        <h2>íŒ€ ëª…ë‹¨</h2>
        <table class="team-table">
            <thead>
                <tr>
                    <th>íŒ€ ì´ë¦„</th>
                    <th>íŒ€ì¥</th>
                    <th>ì¶œê²° í™•ì¸</th>
                </tr>
            </thead>
            <tbody id="team-table-body">
                <!-- JSë¡œ ë™ì  ë Œë”ë§ -->
            </tbody>
        </table>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {

    fetch("/instructor/my_sections_teams/") 
        .then(res => {
            if (!res.ok) {
                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ì‘ë‹µ ë³¸ë¬¸ì„ í…ìŠ¤íŠ¸ë¡œ ì½ì–´ ì¶”ê°€ ì •ë³´ í™•ì¸
                return res.text().then(text => {
                    throw new Error(`HTTP error! status: ${res.status}, message: ${text}`);
                });
            }
            return res.json();
        })
        .then(data => {
            const tbody = document.getElementById("team-table-body");
            tbody.innerHTML = "";

            if (data && Array.isArray(data) && data.length > 0) {
                data.forEach(team => {
                    const row = document.createElement("tr");
                    // TeamSerializerê°€ leader_name, leader_idë¥¼ ì œê³µí•œë‹¤ê³  ê°€ì •
                    const leaderDisplay = team.leader_name ? `${team.leader_name} (${team.leader_id})` : (team.leader_id || 'ë¯¸ì§€ì •');
                    const teamDisplayName = (team.team_name && team.team_name.trim() !== "") ? team.team_name : team.team_id;

                    row.innerHTML = `
                        <td>${teamDisplayName}</td>
                        <td>${leaderDisplay}</td>
                        <td>
                            <a class="btn btn-view" href="{% url 'attendance_pages:attendance-detail' %}?team_id=${encodeURIComponent(team.team_id)}&team_name=${encodeURIComponent(teamDisplayName)}">ì¶œê²° ë³´ê¸°</a>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } else if (data && data.message) {
                tbody.innerHTML = `<tr><td colspan="3">${data.message}</td></tr>`;
            } else {
                tbody.innerHTML = `<tr><td colspan="3">ë‹´ë‹¹í•˜ëŠ” íŒ€ì´ ì—†ê±°ë‚˜ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
            }
        })
        .catch(error => {
            console.error("êµìˆ˜ì ë‹´ë‹¹ íŒ€ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ (instructor_attendance.html):", error);
            const tbody = document.getElementById("team-table-body");
            tbody.innerHTML = `<tr><td colspan="3">âŒ íŒ€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ${error.message}</td></tr>`;
        });
});
</script>
{% endblock %}